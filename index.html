<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Wartungs-Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --bosch-red: #d50000; --bosch-blue: #003a6c; --bosch-gray: #eff1f2; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bosch-gray); margin: 0; padding: 20px; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .card { background: white; padding: 15px; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-top: 4px solid #ccc; position: relative; }
        .card.urgent { border-top-color: var(--bosch-red); background: #fff5f5; }
        .btn-export { background: var(--bosch-blue); color: white; padding: 10px 20px; border: none; cursor: pointer; margin-bottom: 20px; }
        .login-area { margin-bottom: 20px; padding: 15px; background: white; border-radius: 4px; }
        select { width: 100%; padding: 5px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="login-area" id="loginArea">
        <input type="email" id="email" placeholder="E-Mail">
        <input type="password" id="password" placeholder="Passwort">
        <button onclick="login()">Login</button>
    </div>
    
    <div id="mainContent" style="display:none;">
        <button class="btn-export" onclick="exportCSV()">ðŸ“Š Audit-Log als CSV exportieren</button>
        <div class="card-grid" id="dashboardGrid">Lade Daten...</div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyD6xGCtU-felOyO_BRsFnVlB4yhC46FgYg", authDomain: "bosch-agie-wartung.firebaseapp.com", databaseURL: "https://bosch-agie-wartung-default-rtdb.europe-west1.firebasedatabase.app", projectId: "bosch-agie-wartung" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        function login() {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
                .catch(err => alert("Fehler: " + err.message));
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('loginArea').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                loadDashboard();
            }
        });

        function loadDashboard() {
            // Hier wÃ¼rde die Logik stehen, die Karten fÃ¼r Agie, HE und Unotron anzeigt
            // Vereinfacht fÃ¼r dieses Beispiel:
            db.ref().on('value', snap => {
                const data = snap.val();
                renderCards(data);
            });
        }

        function renderCards(data) {
            // Karten-Rendering Logik...
        }

        async function exportCSV() {
            const snap = await db.ref('auditLog').once('value');
            const logs = snap.val();
            if(!logs) return alert("Keine Daten vorhanden");

            let csv = "\uFEFFDatum;Uhrzeit;Benutzer;Aktion;Maschine;Details;ReststÃ¼ckzahl;GesamtstÃ¼ckzahl;Paket;Status\n";
            Object.values(logs).forEach(l => {
                csv += `${l.Datum};${l.Uhrzeit};${l.Benutzer};${l.Aktion};${l.Maschine};${l.Details};${l.ReststÃ¼ckzahl};${l.GesamtstÃ¼ckzahl};${l.Paket};${l.Status}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `WartungsLog_${new Date().toLocaleDateString()}.csv`;
            link.click();
        }
    </script>
</body>
</html>
